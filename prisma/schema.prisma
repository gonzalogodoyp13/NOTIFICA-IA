generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(cuid())
  email      String   @unique
  officeName String
  createdAt  DateTime @default(now())

  demandas Demanda[]

  @@map("users")
}

model Tribunal {
  id        Int      @id @default(autoincrement())
  officeId  Int
  nombre    String
  direccion String?
  comuna    String?
  createdAt DateTime @default(now())

  demandas Demanda[]

  @@index([officeId])
  @@map("tribunales")
}

model Abogado {
  id        Int      @id @default(autoincrement())
  officeId  Int
  nombre    String?
  rut       String?
  direccion String?
  comuna    String?
  telefono  String?
  email     String?
  bancoId   Int?
  createdAt DateTime @default(now())
  banco     Banco?   @relation(fields: [bancoId], references: [id])

  demandas Demanda[]

  @@index([bancoId])
  @@index([officeId])
  @@map("abogados")
}

model Comuna {
  id        Int      @id @default(autoincrement())
  officeId  Int
  nombre    String
  region    String?
  createdAt DateTime @default(now())

  ejecutados Ejecutado[]

  @@index([officeId])
  @@map("comunas")
}

model Banco {
  id        Int       @id @default(autoincrement())
  officeId  Int
  nombre    String
  cuenta    String?
  createdAt DateTime  @default(now())
  abogados  Abogado[]

  @@index([officeId])
  @@map("bancos")
}

model AuditLog {
  id        String   @id @default(cuid())
  userEmail String
  action    String
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@index([userEmail])
  @@map("audit_logs")
}

model diligencia_tipos {
  id          Int      @id @default(autoincrement())
  nombre      String
  descripcion String?
  officeId    Int
  createdAt   DateTime @default(now())

  @@index([officeId])
}

model materias {
  id        Int      @id @default(autoincrement())
  officeId  Int
  nombre    String
  createdAt DateTime @default(now())

  @@index([officeId])
}

// üè¢ Office model: represents an office
model Office {
  id        Int      @id @default(autoincrement())
  nombre    String
  createdAt DateTime @default(now())

  demandas Demanda[]

  @@map("offices")
}

// üßæ Demanda model: represents a legal case (causa)
model Demanda {
  id         String   @id @default(cuid())
  rol        String   @unique
  tribunalId Int
  caratula   String
  cuantia    Float
  abogadoId  Int
  officeId   Int
  userId     String
  createdAt  DateTime @default(now())

  tribunal   Tribunal    @relation(fields: [tribunalId], references: [id])
  abogado    Abogado     @relation(fields: [abogadoId], references: [id])
  office     Office      @relation(fields: [officeId], references: [id])
  user       User        @relation(fields: [userId], references: [id])
  ejecutados Ejecutado[]

  @@map("demandas")
}

// üë§ Ejecutado model: represents a defendant (demandado/aval)
model Ejecutado {
  id        String  @id @default(cuid())
  demandaId String
  nombre    String
  rut       String
  direccion String?
  comunaId  Int?
  rvm       Json?

  demanda Demanda @relation(fields: [demandaId], references: [id])
  comuna  Comuna? @relation(fields: [comunaId], references: [id])

  @@map("ejecutados")
}
